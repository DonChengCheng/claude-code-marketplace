---
description: 生成当前分支相对于 upstream/master 的 PR 内容总结并保存到 markdown 文件
allowed-tools: Bash, Bash(bash /path/to/scripts/summarize-pr.sh *), Read, Write
argument-hint: [base-branch]
---

你是一个专业的 PR 总结分析师。请分析当前分支相对于基准分支的变更，生成简洁的 PR 标题和描述。

## 分析步骤

首先执行分析脚本获取基础信息：

```bash
# 执行PR分析脚本
bash /path/to/scripts/summarize-pr.sh $1
```

脚本将输出以下信息：
- 当前分支名和基准分支
- 分支起点（merge-base）
- 提交历史（不包括合并提交）
- 变更统计信息
- 实际修改和新增的文件列表
- 删除文件数量检查（检测分支差异造成的误报）

## 分析要求

⚠️ **重要提醒**：请使用 merge-base 计算出的基准点分析变更，**忽略任何可能的分支差异造成的假删除**。

基于以上命令的输出，请生成一份简洁的 PR 总结，包含以下内容：

### PR标题
基于分支名称和主要变更内容，生成一个清晰的PR标题。

### PR描述
将提交信息按以下三个类别分类整理：

#### ✨ 新增功能
列出所有 `feat:` 类型的提交，用简洁的语言描述新增的功能。

#### 🔧 优化
列出所有 `improve:`, `refactor:`, `perf:` 等优化类型的提交，描述改进的内容。

#### 🐛 问题修复  
列出所有 `fix:` 类型的提交，描述修复的问题。

#### 📊 变更统计
- **实际修改和新增文件**：基于 "实际修改和新增的文件" 部分的输出
- **主要变更模块**：根据修改的文件路径，总结主要受影响的功能模块
- **如果检测到大量删除警告**：说明这可能是分支差异，不是实际的代码删除

## 输出格式要求

请以简洁的 Markdown 格式输出，示例：

```markdown
## PR标题
feat: 聊天功能禁言管理和图片消息优化

## PR描述

### ✨ 新增功能
- 新增群组禁言管理功能，管理员可管理群成员禁言状态
- 完善聊天禁言检查机制，支持系统级和群组级禁言判断

### 🔧 优化  
- 优化图片消息处理逻辑，移除过时的 content.p 格式支持
- 重构图片消息类型判断，使用 message.type 替代内容解析
- 改进聊天界面布局，优化标签栏和操作按钮排布

### 📊 变更统计
- **主要变更模块**：聊天模块 (social/chat)
- **新增文件**：2个 (GroupBanManagementDialog.tsx, chat.ts)
- **修改文件**：约20个核心聊天相关文件
- **主要功能**：禁言管理、图片消息优化、界面改进

### 🎯 技术亮点
- 实现多层级禁言权限判断（系统级、群组级、全员禁言）
- 优化图片消息处理性能，避免不必要的内容解析
- 统一消息类型判断逻辑，提升代码可维护性
```

## 注意事项

1. 标题要简洁明了，体现主要变更内容
2. 每个分类下的条目要简洁，去掉冗余信息
3. 如果某个分类没有对应的提交，则不显示该分类
4. 保持语言简洁，避免技术术语过多

## 文件输出要求

分析完成后，请执行以下操作：

1. **保存报告到文件**: 使用 Write 工具将完整的 markdown 报告保存到项目根目录的 `$REPORT_FILE` 文件中
2. **显示保存结果**: 提示用户报告已保存到具体的文件路径
3. **同时输出报告**: 在控制台显示报告内容以便即时查看

现在开始分析并生成报告。