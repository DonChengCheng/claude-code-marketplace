# Git 提交记录导入指南

## 核心原则

**重要**: 必须使用 `git -C <项目路径>` 执行命令，禁止使用 `cd` 改变工作目录。

---

## 获取 Git 提交记录

### 基本命令

```bash
# 必须使用 git -C <path> 模式
git -C /path/to/project log --all \
  --since="YYYY-MM-DD 00:00:00" \
  --until="YYYY-MM-DD 23:59:59" \
  --author="用户名" \
  --pretty=format:"%H|%an|%ad|%s|%D" \
  --date=format:"%Y-%m-%d %H:%M:%S"
```

### 参数说明

| 参数 | 说明 |
|------|------|
| `git -C <path>` | 在指定目录执行 git 命令，不改变当前工作目录 |
| `--all` | 查询所有分支(本地+远程)，确保不遗漏任何工作 |
| `--author="用户名"` | 只获取当前用户的提交，过滤团队成员的提交 |
| `--since` / `--until` | 日期范围筛选 |
| `%D` | 显示分支引用，用于标注任务所属分支 |

### 获取当前用户名

```bash
git -C /path/to/project config user.name
```

---

## 错误示例 vs 正确示例

### 错误示例 (禁止使用)

```bash
# 禁止: 会改变工作目录
cd /path/to/project && git log

# 禁止: 使用 pushd/popd
pushd /path/to/project
git log
popd
```

### 正确示例

```bash
# 正确: 使用 git -C
git -C /path/to/project log --all --since="2025-01-01" --author="用户名"

# 正确: 访问多个项目
git -C /project1 log --all --since="2025-01-01"
git -C /project2 log --all --since="2025-01-01"
```

---

## 平台配置

### 配置文件查找顺序

1. **项目配置**: `.work-report/platform-config.json`（当前工作目录）
2. **全局配置**: `~/.claude/work-report/platform-config.json`

如果两个位置都没有配置文件,则省略平台标签。

### 配置格式
```json
{
  "projectPlatformMapping": {
    "example-web-app": "网页",
    "my-mobile-app": "微信小程序",
    "test-project": "测试项目"
  }
}
```

### 平台识别逻辑

1. 从项目路径中提取项目名称（最后一级目录名）
2. 按优先级查找配置文件
3. 在配置中查找对应的平台名称（支持部分匹配）
4. 将平台信息与任务关联，用于总结部分显示
5. **如果没有配置文件或项目未匹配,则省略平台标签**

### 快速创建配置

使用 `/config-platform` 命令可以快速创建配置文件。

---

## 提交解析流程

1. **按时间顺序排序提交**
2. **过滤 Merge 提交**（可选，询问用户）
3. **提取任务名称**，分离类型前缀
4. **推断未标注的任务类型**（参考 task-type-rules.md）
5. **使用提交时间作为实际交付时间**
6. **自动识别分支名称**
7. **识别项目平台**

---

## 智能推断规则

| 字段 | 默认值/推断规则 |
|------|----------------|
| 任务类型 | 根据提交说明推断（参考类型推断规则） |
| 预计耗时 | 默认 1 小时 |
| 当天耗时 | 默认 1 小时 |
| 进度 | 默认 100%（已提交表示已完成） |
| 实际交付时间 | 使用提交时间 |
| 接收任务时间 | 默认当天 09:00 |
| 平台 | 从配置文件匹配,无配置则省略 |

---

## 注意事项

1. **保持工作目录不变**: 整个执行过程中，工作目录必须保持不变
2. **使用绝对路径**: 所有涉及其他项目的操作都使用绝对路径
3. **提交数量过多**: 如果提交数量过多，提示用户是否需要手动筛选
4. **Merge 提交**: 询问用户是否需要排除 Merge 提交
