# 月报工作流程详细说明

本文档包含月报生成的详细工作流程，供需要深入了解实现细节时参考。

---

## 智能混合模式 (详细流程)

### 1. 查找本月周报文件

```javascript
使用 Glob 查找: "周报_*.md"
筛选日期在本月范围内的文件
```

### 2. 计算周报覆盖范围

```javascript
周报覆盖日期集合 = new Set()
for (周报 in 本月周报列表) {
  从文件名提取起始和结束日期
  将覆盖的所有日期加入集合
}
```

### 3. 识别未覆盖日期

```javascript
未覆盖日期 = 月报日期范围 - 周报覆盖日期集合
if (未覆盖日期.length > 0) {
  显示: "⚠️ 检测到以下日期未被周报覆盖: {未覆盖日期}"
}
```

### 4. 自动查找并补充日报

```javascript
for (日期 in 未覆盖日期) {
  查找 "日报_" + 日期 + ".md"
  if (存在) 读取并解析
  else 显示警告
}
```

### 5. 读取并解析周报

- 提取3个表格中的任务信息
- 提取耗时、状态、备注

### 6. 读取并解析补充日报

- 转换日报12字段到月报9字段
- 根据类型分类到对应表格

### 7. 数据去重和合并

- 检查跨周/跨天重复任务
- 合并工时，更新最终交付时间

### 8. 统计计算和覆盖率报告

```
📊 数据覆盖情况:
✓ 已覆盖: {覆盖天数}/{总天数}天 ({覆盖率}%)
```

---

## 仅从周报汇总模式

跳过日报补充步骤，其余流程同智能混合模式。

---

## 仅从日报汇总模式

直接从日报汇总，跳过周报处理:

1. 查找本月所有日报文件
2. 解析日报内容
3. 任务分类汇总
4. 数据去重合并
5. 统计计算

---

## 交互式/导入/空白模板模式

与周报类似的处理方式。

---

## 数据验证规则

### 数据覆盖完整性检查

```javascript
覆盖率 = (覆盖天数 / 总天数) * 100%
if (覆盖率 < 90%) {
  警告: "数据覆盖率较低，可能影响月报完整性"
}
```

### 内容完整性检查

- 4个主要部分
- 3个9字段表格
- 底部统计信息

### 逻辑验证

- 时间逻辑正确
- 统计数据准确

---

## 月报输出格式

### 文件结构

```markdown
### **网页开发工程师 - 董成成月报 (YYYY年MM月)**

## 一、本月工作总结

**工作概述:**
[概述内容]

### 新增功能开发
[9字段表格]

### 交互调整或优化
[9字段表格]

### Bug修复
[9字段表格]

## 二、关键进展
1. 要点1
2. 要点2
3. 要点3

## 三、问题反馈
[问题内容]

## 四、下月计划
1. 计划1
2. 计划2

*总工时：XX小时 | AI辅助率：XX% | 完成任务：XX项*
```

### 文件命名

`YYYY年MM月工作月报.md`

---

## 完成反馈模板

```
✓ 月报生成完成!

📊 数据来源详情:
周报文件: {周报数量}个
日报文件: {日报数量}个

📅 覆盖情况:
覆盖率: {覆盖天数}/{总天数}天 ({覆盖率}%)

📈 任务统计:
总任务数: {总任务数}项
总工时: {总工时}小时
AI辅助率: {AI辅助率}%
```
