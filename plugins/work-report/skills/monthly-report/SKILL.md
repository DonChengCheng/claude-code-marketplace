---
name: monthly-report
description: 生成工作月报，汇总本月工作。当用户需要创建月报、汇总周报和日报、生成本月/上月工作总结时触发。支持智能混合（周报+日报）、交互式填写等模式。
allowed-tools: Read, Write, Edit, Bash(date:*), Glob, AskUserQuestion, TodoWrite
---

# 工作月报生成

## 快速开始

智能混合模式（最常用，强烈推荐）:

```bash
# 1. 获取本月日期范围
year=$(date +%Y)
month=$(date +%m)
first_day="${year}-${month}-01"
last_day=$(date -v1d -v+1m -v-1d +%Y-%m-%d)

# 2. 查找本月周报和日报
ls 周报_${year}年${month}月*.md 2>/dev/null
ls 日报_${year}-${month}-*.md 2>/dev/null
```

## 参考文档

| 文档 | 用途 |
|------|------|
| `references/detailed-workflow.md` | 各模式详细工作流程 |
| `../shared/task-type-rules.md` | 任务类型推断规则 |
| `../shared/table-fields.md` | 9字段表格规范 |
| `../shared/date-calculation.md` | 日期计算逻辑 |

## 关键约束

| 约束 | 规则 |
|------|------|
| 日期确认 | **必须**先明确"本月"还是"上月" |
| 智能混合 | 周报优先，自动补充未覆盖日期的日报 |
| 覆盖率 | < 90% 时显示警告 |
| 任务去重 | 跨周/跨天任务只统计一次 |

## 月报结构

| 部分 | 内容 |
|------|------|
| 本月工作总结 | 概述 + 3个9字段表格 |
| 关键进展 | 2-3个要点 |
| 问题反馈 | 困难、需协调资源 |
| 下月计划 | 下月任务 |
| 统计信息 | 总工时、AI辅助率、完成数、覆盖率 |

## 工作流程

1. **初始化**: 确认本月/上月、计算日期范围、确认给用户
2. **选择模式**: 智能混合(推荐) / 仅周报 / 仅日报 / 交互式 / 导入 / 空白
3. **执行**: 按 `references/detailed-workflow.md` 执行对应模式
4. **验证**: 覆盖率检查、内容完整性、逻辑验证
5. **生成**: 4部分 + 3表格 + 统计 → `YYYY年MM月工作月报.md`

## 错误处理

| 场景 | 处理 |
|------|------|
| 覆盖率<90% | 警告并列出未覆盖日期 |
| 无周报/日报 | 建议其他模式 |
| 月报已存在 | 询问覆盖 |
| 文件解析失败 | 警告并跳过 |

## 成功标准

生成的月报必须包含:
- 4个主要部分（总结、进展、问题、计划）
- 3个完整的9字段表格
- 数据覆盖率 ≥ 90%
- 准确的统计信息
