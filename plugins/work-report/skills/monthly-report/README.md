# 月报生成 Agent Skill

智能工作月报生成助手,支持从周报/日报汇总和交互式填写。

## 功能特性

### 核心能力

1. **从周报汇总** (推荐) - 自动读取本月所有周报文件并智能汇总
2. **从日报汇总** - 自动读取本月所有日报文件并汇总生成月报
3. **交互式填写** - 通过对话逐步完成月报各部分内容
4. **从数据源导入** - 从指定文件或目录导入数据生成月报
5. **空白模板** - 生成基于模板的空白月报供手动填写

### 智能特性

- **自动任务分类**: 智能将任务分类到新增功能、交互优化、Bug修复
- **任务去重**: 自动检测并合并跨周/跨天的重复任务
- **工时汇总**: 准确统计本月总工时和各任务耗时
- **数据统计**: 自动计算总工时、AI辅助率、完成任务数
- **类型识别**: 自动提取和推断任务类型标签
- **数据验证**: 确保报告完整性和准确性

## 使用方法

### 方法1: 通过自定义命令(推荐)

```bash
/generate-monthly-report
```

或带参数指定数据源:

```bash
/generate-monthly-report /path/to/reports/
```

### 方法2: 直接调用 Skill

如果你在代码中需要调用,可以使用 Skill 工具:

```markdown
请使用 monthly-report skill 帮我生成本月的工作月报
```

## 生成模式

### 模式1: 从周报汇总 (推荐)

**适用场景**: 本月已经生成了周报文件

**工作流程**:
1. 自动查找本月所有周报文件
2. 提取每个周报的3个任务表格
3. 智能去重和合并跨周任务
4. 汇总统计数据(工时、AI辅助率等)
5. 生成月度工作概述和关键进展
6. 引导填写问题反馈和下月计划

**优点**:
- 最高效,完全自动化
- 数据最准确,直接来源于周报
- 保持周报和月报的一致性

### 模式2: 从日报汇总

**适用场景**: 本月没有周报,但有日报文件

**工作流程**:
1. 自动查找本月所有日报文件
2. 提取每个日报的任务表格(12字段)
3. 转换为月报格式(9字段)
4. 智能分类任务到3个表格
5. 去重和合并跨天任务
6. 汇总统计数据
7. 生成月度总结

**字段映射**:
```
日报12字段 → 月报9字段
- 任务名称 → 名称
- 任务规定完成时间 → 规定交付时间
- 总耗时 → 开发/修复耗时
- 当前进度 → 状态(100%=已完成)
- 是否存在异常 + AI处理百分比 → 备注
```

### 模式3: 交互式填写

**适用场景**: 没有现成的周报或日报,手动填写月报

**工作流程**:
1. 引导填写本月工作概述
2. 逐个录入新增功能开发任务
3. 逐个录入交互调整或优化任务
4. 逐个录入Bug修复任务
5. 填写关键进展(2-3个要点)
6. 填写问题反馈
7. 填写下月计划
8. 自动生成统计信息

### 模式4: 从数据源导入

**适用场景**: 有其他格式的工作记录文件

**支持的数据源**:
- 单个周报或日报文件
- 包含多个报告文件的目录
- 其他格式的任务记录文件

**工作流程**:
1. 询问数据源路径
2. 判断是文件还是目录
3. 智能解析文件格式
4. 提取任务信息
5. 生成完整月报

### 模式5: 空白模板

**适用场景**: 需要一个标准格式的空白月报,手动填写

**生成内容**:
- 完整的月报结构框架
- 带有示例的3个任务表格
- 格式说明和填写提示

## 月报规范

### 月报结构

月报包含4个主要部分:

#### 一、本月工作总结
1. 本月工作概述
2. 新增功能开发表格(9字段)
3. 交互调整或优化表格(9字段)
4. Bug修复表格(9字段)

#### 二、关键进展
2-3个要点,突出本月重要成果

#### 三、问题反馈
遇到的困难、需要协调的资源等

#### 四、下月计划
下月的主要工作任务

#### 底部统计
`*总工时：XX小时 | AI辅助率：XX% | 完成任务：XX项*`

### 表格字段说明

所有3个表格都包含9个字段:

| 字段名 | 说明 | 示例 |
|:---|:---|:---|
| 序号 | 任务编号 | 1, 2, 3... |
| 类型 | 任务类型标签 | 小模块, 操作, 页面 |
| 名称 | 任务名称 | 用户登录功能开发 |
| 接收任务时间 | 任务开始时间 | 2025-10-01 |
| 规定交付时间 | 任务截止时间 | 2025-10-05 |
| 实际交付时间 | 实际完成时间 | 2025-10-04 |
| 开发/修复耗时 | 总耗时(小时) | 8.0 |
| 状态 | 任务状态 | 已完成/进行中 |
| 备注 | 额外说明 | 无异常, AI辅助30% |

### 任务类型标签

#### 新增功能分级
- `大系统`: 超过10个模块的系统级功能
- `小系统`: 10个模块以内的系统级功能
- `大模块`: 超过15个功能的模块级功能
- `小模块`: 15个功能以内的模块级功能
- `页面`: 单个页面级别的开发

#### Bug修复分类
- **系统级别**: `大系统`, `小系统`
- **模块级别**: `大模块`, `小模块`
- **页面类**: `列表页`, `详情页`
- **操作类**: `新增`, `删除`, `编辑`, `复制`, `移动`, `筛选/搜索`, `排序`, `分享`

#### 交互优化分类
- `操作`: 功能操作优化
- `页面`: 页面布局优化

## 文件格式

### 输入文件格式

**周报文件**:
- 文件名格式: `周报_YYYY年MM月DD日-MM月DD日.md`
- 示例: `周报_2025年10月14日-10月20日.md`

**日报文件**:
- 文件名格式: `日报_YYYY-MM-DD.md`
- 示例: `日报_2025-10-18.md`

### 输出文件格式

**月报文件**:
- 文件名格式: `YYYY年MM月工作月报.md`
- 示例: `2025年10月工作月报.md`
- 保存位置: 当前工作目录

## 使用示例

### 示例1: 从周报自动生成月报

```bash
/generate-monthly-report
```

```
选择: 1. 从周报汇总

找到 4 个本月周报文件...
提取到 156 个任务...
去重后保留 148 个任务...

请简要描述本月工作概述:
> 本月主要完成了随缘相遇功能的全面开发和优化,修复了大量用户反馈的问题

是否有需要反馈的问题?
> 无

请输入下月工作计划:
> 1. 继续优化随缘相遇功能
> 2. 开发新的活动模块
> 完成

✓ 月报生成完成!
文件已保存: 2025年10月工作月报.md
```

### 示例2: 从指定目录的日报生成月报

```bash
/generate-monthly-report ./reports/october/
```

```
检测到目录,正在查找报告文件...
找到 0 个周报文件
找到 22 个日报文件

使用日报汇总模式...
提取到 88 个任务...
智能分类完成...

...
```

### 示例3: 交互式填写月报

```bash
/generate-monthly-report
```

```
选择: 3. 交互式填写

请简要描述本月工作概述:
> ...

现在开始填写新增功能开发任务
请输入第1个功能的名称 (输入"完成"结束):
> 用户登录功能开发

✓ 推断类型: 操作

接收任务时间 (YYYY-MM-DD):
> 2025-10-01

...
```

## 数据统计说明

### 总工时计算

```
总工时 = sum(所有任务的开发/修复耗时)
```

从周报汇总时,直接汇总各任务的耗时
从日报汇总时,合并跨天任务的总耗时,避免重复计算

### AI辅助率计算

```
AI辅助率 = average(所有任务的AI处理百分比)
```

从周报汇总时,从周报底部统计信息提取
从日报汇总时,计算所有任务的AI百分比平均值

### 完成任务数计算

```
完成任务数 = count(状态 == "已完成")
```

只统计状态为"已完成"的任务,进行中的任务不计入

## 任务去重逻辑

在从多个周报或日报汇总时,Agent 会自动检测并合并重复任务:

**判断重复的条件**:
- 任务名称相同
- 类型相同

**合并规则**:
- 保留最早的接收时间
- 保留最晚的实际交付时间
- 累加工时(从日报汇总时)
- 更新为最新的状态
- 合并备注信息

## 常见问题

### Q: 本月既有周报又有日报,应该用哪个?

A: 优先使用"从周报汇总",因为周报已经完成了任务的初步分类和汇总,数据更清晰准确。

### Q: 生成的月报文件名格式是什么?

A: `YYYY年MM月工作月报.md`,例如 `2025年10月工作月报.md`

### Q: 如何判断一个任务属于哪个表格?

A: Agent 会根据以下规则自动分类:
- 类型为 `大系统`, `小系统`, `大模块`, `小模块`, `页面` → 新增功能开发
- 任务名包含"优化"、"调整"、"改进" → 交互调整或优化
- 任务名包含"修复"、"Bug"、"fix" → Bug修复

### Q: 跨月任务如何处理?

A: 跨月任务会根据其实际交付时间归属到对应月份。如果某任务在本月开始但下月完成,本月月报中会标记为"进行中"。

### Q: 月报已存在,会被覆盖吗?

A: Agent 会先询问是否覆盖现有文件,需要用户确认后才会覆盖。

### Q: 可以自定义月报模板吗?

A: 可以,修改 `.claude/skills/monthly-report/template.md` 或项目根目录的 `月报模板.md` 即可。

## 技术说明

### 文件结构

```
.claude/skills/monthly-report/
├── SKILL.md         # Agent 核心配置和工作流程
├── template.md      # 月报模板文件
└── README.md        # 本文档
```

### 权限和工具

Agent 使用以下工具:
- `Read`: 读取周报、日报、模板文件
- `Write`: 创建月报文件
- `Edit`: 编辑现有文件
- `Bash(date:*)`: 获取日期信息
- `Glob`: 查找周报和日报文件
- `AskUserQuestion`: 与用户交互
- `TodoWrite`: 任务进度跟踪

### 调用方式

通过自定义命令调用:

```markdown
# .claude/commands/generate-monthly-report.md
---
allowed-tools: Skill
---
请使用 monthly-report skill 帮我生成本月的工作月报。
$ARGUMENTS
```

## 更新日志

### v1.0.0 (2025-10-19)
- 初始版本发布
- 支持从周报汇总生成月报
- 支持从日报汇总生成月报
- 支持交互式填写
- 支持数据源导入
- 支持空白模板生成
- 智能任务分类和去重
- 自动数据统计和验证

## 贡献

如有问题或建议,请联系开发团队或提交 Issue。

## 许可

内部工具,仅供团队使用。
