# 日报生成 Agent Skills 使用指南

## 简介

这是一个智能工作日报生成助手,可以通过交互式对话或自动导入数据来生成符合规范的工作日报。

## 核心特性

- ✅ **交互式填写**: 友好的对话式引导,逐步完成日报填写
- ✅ **智能推断**: 自动识别任务类型,无需手动选择
- ✅ **时间计算**: 自动计算工时、总工时,无需手动统计
- ✅ **进度跟踪**: 支持多天任务,自动累计工时
- ✅ **数据验证**: 确保所有字段完整,逻辑正确
- ✅ **灵活模式**: 支持4种不同的日报生成方式
- ✅ **平台识别**: 可配置项目与平台的映射,自动显示任务所属平台

## 如何使用

### 方式1: 通过 Skill 工具调用 (推荐)

在 Claude Code 中直接使用:

```
请使用 daily-report skill 帮我写今天的日报
```

或者:

```
/daily-report
```

### 方式2: 通过命令调用

如果您配置了slash命令,可以使用:

```
/generate-daily-report
```

## 平台配置 (可选)

平台配置用于在日报总结中显示任务所属的平台（如网页端、移动端等）。配置后,Git导入时会自动匹配平台,总结中显示如 `[网页端] 用户登录功能开发`。

### 快速配置

使用命令快速创建配置文件:

```
/config-platform
```

该命令会引导你:
1. 选择配置文件位置（全局或项目级）
2. 扫描当前目录下的 git 项目
3. 为每个项目指定平台名称
4. 自动生成配置文件

### 配置文件位置

配置文件查找顺序（优先级从高到低）:

1. **项目配置**: `.work-report/platform-config.json`（当前工作目录）
2. **全局配置**: `~/.claude/work-report/platform-config.json`

### 配置文件格式

```json
{
  "projectPlatformMapping": {
    "my-web-app": {
      "platform": "网页端",
      "path": "/Users/xxx/projects/my-web-app"
    },
    "my-mobile-app": {
      "platform": "移动端",
      "path": "/Users/xxx/projects/my-mobile-app"
    },
    "my-backend": {
      "platform": "后端服务",
      "path": "/Users/xxx/projects/my-backend"
    },
    "my-miniprogram": {
      "platform": "微信小程序",
      "path": "/Users/xxx/projects/my-miniprogram"
    }
  }
}
```

- **键**: 项目标识名（支持部分匹配,如 `my-app` 可匹配 `my-app-v2`）
- **值**: 对象，包含 `platform`（平台显示名称）和 `path`（项目绝对路径）

### 无配置时的行为

如果没有配置文件或项目未匹配到平台,日报总结中将省略平台标签:

```markdown
### 新增功能开发
1. 用户登录功能开发
2. 订单管理页面 (进度: 80%)
```

## 支持的4种模式

### 1. 交互式填写 (最常用)

**适用场景**: 每天下班前填写当天的工作日报

**使用方式**:
```
请用 daily-report skill 帮我写日报
```

**流程**:
1. 系统询问选择模式,选择"交互式填写"
2. 输入任务名称,系统自动推断类型
3. 确认或修改时间信息
4. 输入进度和耗时
5. 继续添加更多任务或完成生成

**示例对话**:
```
用户: 请用 daily-report skill 帮我写日报

Agent: 已获取今日日期: 2025-10-18
      检查到日报模板文件存在

      请选择日报生成方式:

用户: 交互式填写

Agent: 开始交互式填写日报

      请输入第1个任务的名称:

用户: 用户登录页面开发

Agent: ✓ 任务名称: 用户登录页面开发
      ✓ 推断类型: [页面] (包含关键词"页面"、"开发")

      请输入接收任务时间 (默认: 2025-10-18 09:00):

用户: (直接回车)

Agent: ✓ 接收时间: 2025-10-18 09:00

      当前进度 (0-100%):

用户: 100

Agent: ✓ 进度: 100%

      实际交付时间:

用户: 2025-10-18 11:30

Agent: ✓ 交付时间: 2025-10-18 11:30

      当天耗时 (小时):

用户: 2.5

Agent: ✓ 当天耗时: 2.5h

      是否存在异常 (有/无):

用户: 无

Agent: ✓ 异常: 无

      是否继续添加任务?

用户: 是

... (继续添加更多任务)
```

### 2. 从数据源导入 (推荐用于 Git 提交)

**适用场景**:
- 从 Git 提交记录自动生成日报 ⭐️ 推荐
- 已有其他系统的任务数据,需要转换为日报格式

**使用方式**:
```
请用 daily-report skill 从 Git 提交记录生成日报
```

#### 从 Git 提交记录生成 (v1.1.0 新功能)

**功能亮点**:
- ✅ 自动扫描所有分支的提交,不会遗漏任何工作
- ✅ 自动过滤当前用户的提交
- ✅ 智能推断任务类型
- ✅ 支持多个项目同时扫描

**使用示例**:
```
用户: 请根据 /path/to/project1 和 /path/to/project2 的 git 提交记录生成今天的日报

Agent: 已获取今日日期: 2025-10-20

      发现以下 Git 提交记录:

      项目1 (/path/to/project1):
      - 09:23 [feat] 添加社区通知删除功能
      - 11:25 [feat] 优化随缘相遇活动奖品标签样式

      项目2 (/path/to/project2):
      - 14:42 [feat] 在我的缘分页面添加奖品使用说明区块

      共识别到 3 个任务,是否生成日报?
```

**重要改进 (v1.1.0)**:
- ⚠️ 使用 `git log --all` 查询所有分支,确保不遗漏功能分支的提交
- ⚠️ 自动过滤 Merge 提交(可选)
- ✅ 支持标注每个任务所属的分支

**其他数据源格式**:
- Markdown 列表
- JSON 格式
- CSV 文件
- 纯文本任务列表

**数据源示例** (tasks.md):
```markdown
1. [操作] 用户登录功能开发 - 2.5h
2. [页面] 聊天列表页面优化 - 1.5h
3. [操作] 修复图片上传bug - 0.8h
```

### 3. 继续昨日任务

**适用场景**: 昨天有未完成的任务,今天继续工作

**使用方式**:
```
请用 daily-report skill 继续昨天的任务
```

**功能**:
- 自动读取昨日日报
- 识别进度 < 100% 的任务
- 累计计算总工时
- 更新任务进度

### 4. 空白模板

**适用场景**: 需要手动编辑日报,只需要一个标准格式

**使用方式**:
```
请用 daily-report skill 生成空白日报模板
```

**输出**: 基于模板的空白日报,保留示例行供参考

## 智能推断功能

### 任务类型自动识别 (v1.2.0 改进)

系统会根据任务名称中的关键词**按优先级**自动判断类型:

#### 优先级规则

**优先级1: [页面] 类型** (UI/视觉相关优先)
- 显示相关: "显示"、"隐藏"、"展示"、"呈现"
- 样式相关: "样式"、"颜色"、"渐变"、"背景"
- 布局相关: "布局"、"排版"、"位置"、"对齐"
- 视觉元素: "弹窗"、"导航栏"、"标签"、"卡片"、"资料卡"
- 文案内容: "文案"、"说明"、"规则"、"内容"、"FAQ"
- 层级问题: "z-index"、"层级"、"遮罩"
- 页面/界面: "页面"、"界面"、"UI"、"视图"

**优先级2: [操作] 类型** (功能/逻辑相关)
- 功能开发: "功能"、"特性"、"能力"(不涉及UI时)
- 接口对接: "接口"、"API"、"调用"、"请求"
- 逻辑处理: "逻辑"、"算法"、"计算"、"处理"
- 数据操作: "添加"、"删除"、"修改"、"更新"(不涉及UI时)

#### 分类示例

| 任务描述 | 类型 | 理由 |
|---------|------|------|
| 用户登录功能开发 | [操作] | 涉及功能逻辑,不涉及UI |
| 聊天列表页面优化 | [页面] | 包含"页面"关键词 |
| 优化随缘相遇活动奖品标签样式 | [页面] | 包含"样式"和"标签",属于UI |
| 修复成员资料卡z-index层级问题 | [页面] | 包含"z-index"、"层级",属于视觉层级 |
| 优化本地文件上传对话框布局和进度显示 | [页面] | 包含"布局"和"显示",属于UI |
| 完善奖品使用说明，添加总体说明文字 | [页面] | 包含"说明"、"文字",属于文案内容 |
| 修复社交聊天文件夹选择器顶部导航栏显示问题 | [页面] | 包含"导航栏"和"显示",属于UI |
| 添加社区通知删除功能 | [操作] | 功能逻辑,不涉及UI |
| 订单管理模块开发 | [小模块] | 包含"模块"、"管理" |
| 支付系统集成 | [大模块] | 包含"系统" |

#### 特殊规则

1. **混合任务优先选择 [页面]**
   - "优化上传功能的进度显示" → [页面] (因为涉及"显示")

2. **文案类任务归为 [页面]**
   - "完善活动规则说明" → [页面]

3. **样式/布局类任务归为 [页面]**
   - "优化标签样式" → [页面]

**提示**: 如果推断不准确,Agent 会询问确认,您可以手动修正。

### 时间智能计算

- **自动填充默认值**: 接收时间默认为今日 09:00,完成时间默认为 18:00
- **工时自动统计**: 自动汇总所有任务的当天耗时
- **跨天任务累计**: 继续昨日任务时,自动累加总工时

### 数据验证

生成日报前会自动验证:
- ✓ 12个字段完整性
- ✓ 时间逻辑正确性 (接收时间 ≤ 完成时间)
- ✓ 进度范围 (0-100%)
- ✓ 工时计算准确性
- ✓ 总工时统计正确

## 生成的日报格式

```markdown
# 工作日报 - 2025-10-18

| 序号 | 类型 | 任务名称 | 接收任务时间 | 任务规定完成时间 | 预计任务耗时 | 当前进度 | 实际交付时间 | 当天耗时 | 总耗时 | 是否存在异常 | 其中当天AI处理的百分比 |
| :--: | :--: | :---------------------: | :-------------: | :--------------: | :----------: | :------: | :----------: | :------: | :----: | :----------: | :--------------------: |
|  1  | [页面] | 用户登录页面开发 | 2025-10-18 09:00 | 2025-10-18 18:00 | 3.0h | 100% | 2025-10-18 11:30 | 2.5h | 2.5h | 无 | 20% |
|  2  | [操作] | 聊天列表功能优化 | 2025-10-18 11:30 | 2025-10-18 18:00 | 2.0h | 100% | 2025-10-18 13:00 | 1.5h | 1.5h | 无 | 15% |
|  3  | [操作] | 图片上传bug修复 | 2025-10-18 14:00 | 2025-10-18 18:00 | 1.0h | 100% | 2025-10-18 14:48 | 0.8h | 0.8h | 无 | 25% |

## 今日工作内容总结

1. [页面] 用户登录页面开发
2. [操作] 聊天列表功能优化
3. [操作] 图片上传bug修复

**总计工作时长**: 4.8小时
```

## 常见问题

### Q1: 如何修改已生成的日报?

可以手动编辑生成的 `日报_YYYY-MM-DD.md` 文件,或者重新运行 skill 并选择覆盖。

### Q2: 任务类型推断错误怎么办?

在交互过程中,Agent 会显示推断结果并询问确认,您可以随时修正。

### Q3: 如何处理跨多天的任务?

使用"继续昨日任务"模式,系统会自动累计总工时。

### Q4: 可以批量导入多个任务吗?

可以,使用"从数据源导入"模式,准备一个包含所有任务的文本文件。

### Q5: 如果今天已经有日报文件了怎么办?

系统会提示文件已存在,询问您是覆盖还是编辑现有文件。

## 最佳实践

1. **每天下班前填写**: 养成每天下班前用交互式模式填写日报的习惯
2. **及时记录**: 完成每个任务后立即记录,避免遗忘细节
3. **准确估时**: 尽量准确记录实际耗时,有助于后续的工作量评估
4. **标注异常**: 遇到问题或阻塞时,在"是否存在异常"中标注"有"
5. **持续任务**: 对于需要多天完成的任务,使用"继续昨日任务"模式

## 技术支持

如遇到问题或有改进建议,请查看:
- Skill 定义文件: `.claude/skills/daily-report/SKILL.md`
- 日报模板: `.claude/skills/daily-report/template.md`

## 更新日志

### v1.2.0 (2025-10-20) 🎯
- ✅ **重要更新**: 任务类型推断规则优化
  - 引入优先级机制: UI/视觉相关优先归为 [页面]
  - 大幅扩充 [页面] 类型关键词(样式、布局、显示、文案等)
  - 添加特殊规则处理混合任务
  - 提升UI相关任务的分类准确性
- ✅ 更新文档,添加详细的分类示例和规则说明
- ✅ 修正今日日报中的任务类型分类错误

### v1.1.0 (2025-10-20) 🎉
- ✅ **重要更新**: Git 提交记录查询改进
  - 使用 `git log --all` 查询所有分支,避免遗漏功能分支的提交
  - 添加 `--author` 参数自动过滤当前用户的提交
  - 支持标注任务所属的分支名称
  - 可选择是否包含 Merge 提交
- ✅ 支持多个 Git 项目同时扫描
- ✅ 改进日报生成的准确性和完整性

### v1.0.0 (2025-10-18)
- ✅ 初始版本发布
- ✅ 支持4种日报生成模式
- ✅ 智能任务类型推断
- ✅ 自动时间计算和验证
- ✅ 进度跟踪和跨天任务支持
